#!/bin/bash
scope=@covalent
tag=latest

[[ $1 = 'next' ]] && tag=next || tag=latest

if [ "$NPM_TOKEN" == "" ]; then
  echo "NPM Token is not set. export the token using NPM_TOKEN"
  exit 1;
fi

npm config set //registry.npmjs.org/:_authToken ${NPM_TOKEN}

for package in ./dist/libs/*
do
  if [ -d ${package} ]
  then
    # ignore experimental package
    if [[ !(${package} =~ "experimental") ]]
    then
      npm publish ${package} --access=public --tag=$tag --ignore-scripts
    fi
  fi
done

echo "Published successfully [scope: $scope]. Use 'npm install [package-name]' in the project you want to use it."
exit 0